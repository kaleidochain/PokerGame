{"version":3,"sources":["assets/scripts/Wallet/LoginAccount.js"],"names":["Log","require","cc","Class","Component","properties","selectAccountPopup","Node","currentNickname","RichText","editPassword","EditBox","loginPasswordErrorTips","Label","normalLoadingLayer","onLoad","string","dgame","utils","formatRichText","settings","account","Nickname","LoginNickname","LoginAddr","Addr","start","onBtnChangeCurrentAccountClicked","active","loadLocalAccounts","onBtnCloseSelectAccountPopupClicked","onLinkLoginMnemonicClicked","sceneList","push","director","getScene","name","loadScene","accountList","find","getComponent","data","Array","i","accountsInfo","length","accountInfo","populateList","tryVerifyAccount","nickname","addr","Debug","updateSelection","tryNewAccount","onBtnConfirmClicked","Chips","KAL","onBtnLoginClicked","testAddrMap","_getTestAddrMap","_startInvokeWaiting","scheduleOnce","ret","sys","isNative","isMobile","os","OS_IOS","jsb","reflection","callStaticMethod","OS_ANDROID","OS_WINDOWS","OS_OSX","StartNode","onOpen","_stopInvokeWaiting","LoginCount","undefined","localStorage","setItem","JSON","stringify","Password","tutorial","parse","getItem","TexasHoldem","addrMap","onEditingPasswordBegan"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Log = require(\"Log\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        selectAccountPopup: cc.Node,\n        currentNickname: cc.RichText,\n        editPassword: cc.EditBox,\n        loginPasswordErrorTips: cc.Label,\n        normalLoadingLayer: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    onLoad () {\n        this.currentNickname.string = cc.dgame.utils.formatRichText(cc.dgame.settings.account.Nickname, \"#DAEDFF\", true, true);\n        cc.dgame.settings.account.LoginNickname = cc.dgame.settings.account.Nickname;\n        cc.dgame.settings.account.LoginAddr = cc.dgame.settings.account.Addr;\n    },\n\n    start () {\n\n    },\n\n    onBtnChangeCurrentAccountClicked () {\n        this.selectAccountPopup.active = true;\n        this.loadLocalAccounts();\n    },\n\n    onBtnCloseSelectAccountPopupClicked () {\n        this.selectAccountPopup.active = false;\n    },\n\n    onLinkLoginMnemonicClicked () {\n        cc.dgame.sceneList.push(cc.director.getScene().name);\n        cc.director.loadScene(\"LoginMnemonic\");\n    },\n\n    loadLocalAccounts () {\n        var accountList = cc.find(\"login_bg/scrollview\", this.selectAccountPopup).getComponent(\"AccountList\");\n        var data = new Array();\n        for (var i = 0; i < cc.dgame.settings.accountsInfo.length; i++) {\n            var accountInfo = {};\n            accountInfo.Nickname = cc.dgame.settings.accountsInfo[i].Nickname;\n            accountInfo.Addr = cc.dgame.settings.accountsInfo[i].Addr;\n            data.push(accountInfo);\n        }\n        accountList.populateList(data);\n    },\n    // update (dt) {},\n\n    //点击下拉列表中的昵称会调用\n    tryVerifyAccount (nickname, addr) {\n        Log.Debug(\"clicked: \" + nickname + \", \" + addr);\n        cc.dgame.settings.account.LoginNickname = nickname;\n        cc.dgame.settings.account.LoginAddr = addr;\n        var accountList = cc.find(\"login_bg/scrollview\", this.selectAccountPopup).getComponent(\"AccountList\");\n        accountList.updateSelection();\n    },\n\n    //点击下拉列表中的New Account会调用\n    tryNewAccount () {\n        this.selectAccountPopup.active = false;\n        cc.dgame.sceneList.push(cc.director.getScene().name);\n        cc.director.loadScene(\"CreateAccount\");\n    },\n\n    onBtnConfirmClicked () {\n        this.currentNickname.string = cc.dgame.utils.formatRichText(cc.dgame.settings.account.LoginNickname, \"#DAEDFF\", true, true);;\n        cc.dgame.settings.account.Nickname = cc.dgame.settings.account.LoginNickname;\n        cc.dgame.settings.account.Addr = cc.dgame.settings.account.LoginAddr;\n        cc.dgame.settings.account.Chips = 0;\n        cc.dgame.settings.account.KAL = 0;\n        this.selectAccountPopup.active = false;\n    },\n\n    onBtnLoginClicked () {\n        let testAddrMap = this._getTestAddrMap();\n        if (testAddrMap[cc.dgame.settings.account.Addr] == 1) {\n            this.editPassword.string = \"123456\"; //test\n        }\n        this._startInvokeWaiting();\n        this.scheduleOnce(function () {\n            var ret = false;\n            if (cc.sys.isNative) {\n                if (cc.sys.isMobile) {\n                    if (cc.sys.os === cc.sys.OS_IOS) {\n                        ret = jsb.reflection.callStaticMethod(\"NativeGengine\", \"startGameEngineWithAccount:andPassword:\", cc.dgame.settings.account.Addr, this.editPassword.string)\n                    } else if (cc.sys.os === cc.sys.OS_ANDROID) {\n                        ret = jsb.reflection.callStaticMethod(\"io/kaleidochain/NativeGengine\", \"startGameEngineWithAccountAndPassword\", \"(Ljava/lang/String;Ljava/lang/String;)Z\", cc.dgame.settings.account.Addr, this.editPassword.string)\n                    }\n                } else {\n                    if (cc.sys.os === cc.sys.OS_WINDOWS||cc.sys.os === cc.sys.OS_OSX) {\n                        ret = StartNode(cc.dgame.settings.account.Addr, this.editPassword.string);\n                    }\n                }\n            }\n            Log.Debug(\"ret = \"+ret);\n            cc.dgame.settings.onOpen = false;\n            this._stopInvokeWaiting();\n            if (ret) {\n                if (cc.dgame.settings.account.LoginCount == null || cc.dgame.settings.account.LoginCount == undefined) {\n                    cc.dgame.settings.account.LoginCount = 0;\n                }\n                cc.dgame.settings.account.LoginCount++;\n                cc.sys.localStorage.setItem(\"currentAccount\", JSON.stringify(cc.dgame.settings.account));\n                cc.dgame.settings.account.Password = this.editPassword.string;\n                cc.dgame.settings.account.Chips = 0;\n                cc.dgame.settings.account.KAL = 0;\n                let tutorial = JSON.parse(cc.sys.localStorage.getItem(\"tutorial\"));\n                if (!tutorial.TexasHoldem) {\n                    cc.director.loadScene(\"TexasHoldemTutorial\");\n                } else {\n                    cc.director.loadScene(\"GameHall\");\n                }\n            } else {\n                this.loginPasswordErrorTips.string = \"Incorrect password\";\n                this.editPassword.string = \"\";\n            }\n        }, 1);\n    },\n\n    _getTestAddrMap() {\n        let addrMap = {\n            \"0x34F0Be687F187e8F5eaDBb7D577EDaB74240Bcd1\": 1,\n            \"0x8b272f232a2c7eA3BF1497E3C57F3bf216cA81dB\": 1,\n            \"0x3B7B045890776aC15685483A55d121a74Dc95517\": 1,\n            \"0xE6aD43fc087E91bD7c041658f06675fd8d2223A1\": 1,\n            \"0x2E35770BF145d89271dee1F3b897b7807Bd36896\": 1,\n            \"0xc49e8b9F4fAb77197A5A7383930061E7613F8eAf\": 1,\n        };\n        return addrMap\n    },\n\n    onEditingPasswordBegan() {\n        this.loginPasswordErrorTips.string = \"\";\n    },\n\n    _startInvokeWaiting () {\n        this.normalLoadingLayer.active = true;\n    },\n\n    _stopInvokeWaiting () {\n        this.normalLoadingLayer.active = false;\n    },\n});\n"]}