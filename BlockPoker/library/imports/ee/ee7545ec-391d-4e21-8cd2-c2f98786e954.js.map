{"version":3,"sources":["assets/scripts/Net/HTTP.js"],"names":["URL","Log","require","HTTP","cc","Class","Component","statics","sessionId","userId","master_url","url","sendRequest","path","data","handler","extraUrl","xhr","loader","getXMLHttpRequest","timeout","ontimeout","abort","timerId","setTimeout","str","k","requestURL","encodeURI","Trace","open","sys","isNative","setRequestHeader","onreadystatechange","console","log","dgame","utils","getNowFormatDate","readyState","status","clearTimeout","responseText","length","ret","JSON","parse","e","vv","wc","send"],"mappings":"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","sourceRoot":"/","sourcesContent":["//var URL = \"http://127.0.0.1:9000\";\r\n//var URL = \"http://152.32.254.75\";\r\nvar URL = \"http://106.75.184.214\";\r\nvar Log = require(\"Log\")\r\n\r\nvar HTTP = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    statics:{\r\n        sessionId : 0,\r\n        userId : 0,\r\n        master_url:URL,\r\n        url:URL,\r\n        sendRequest : function(path,data,handler,extraUrl){\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.timeout = 5000;\r\n            xhr.ontimeout = function() {\r\n                xhr.abort();\r\n                if (handler !== null) {\r\n                    handler(null, extraUrl);\r\n                }\r\n            };\r\n\r\n            var timerId = setTimeout(xhr.ontimeout, 5000);\r\n            var str = \"?\";\r\n            for(var k in data){\r\n                if(str != \"?\"){\r\n                    str += \"&\";\r\n                }\r\n                str += k + \"=\" + data[k];\r\n            }\r\n            if(extraUrl == null){\r\n                extraUrl = HTTP.url;\r\n            }\r\n            var requestURL = extraUrl + path;\r\n            if (str != \"?\") {\r\n                requestURL += encodeURI(str);\r\n            }\r\n            Log.Trace(\"RequestURL:\" + requestURL);\r\n            xhr.open(\"GET\",requestURL, true);\r\n            if (cc.sys.isNative){\r\n                xhr.setRequestHeader(\"Accept-Encoding\",\"gzip,deflate\",\"text/html;charset=UTF-8\");\r\n                //xhr.setRequestHeader(\"Host\",\"enode.kalscan.io\");\r\n            }\r\n            \r\n            xhr.onreadystatechange = function() {\r\n                console.log(cc.dgame.utils.getNowFormatDate() + \" xhr.readyState: \" + xhr.readyState)\r\n                if(xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)){\r\n                    clearTimeout(timerId);\r\n                    Log.Trace(\"http res(\"+ xhr.responseText.length + \"):\" + xhr.responseText);\r\n                    try {\r\n                        var ret = JSON.parse(xhr.responseText);\r\n                        if (handler !== null){\r\n                            handler(ret, extraUrl);\r\n                        }                        /* code */\r\n                    } catch (e) {\r\n                        Log.Trace(\"err:\" + e);\r\n                        //handler(null);\r\n                    }\r\n                    finally{\r\n                        if(cc.vv && cc.vv.wc){\r\n                        //       cc.vv.wc.hide();    \r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            \r\n            if(cc.vv && cc.vv.wc){\r\n                //cc.vv.wc.show();\r\n            }\r\n            console.log(cc.dgame.utils.getNowFormatDate() + \" before xhr.send\");\r\n            xhr.send();\r\n            console.log(cc.dgame.utils.getNowFormatDate() + \" after xhr.send\");\r\n            return xhr;\r\n        },\r\n    },\r\n});\r\n"]}