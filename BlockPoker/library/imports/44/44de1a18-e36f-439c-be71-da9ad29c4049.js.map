{"version":3,"sources":["assets/scripts/Net/Net.js"],"names":["Log","require","Global","cc","Class","Component","statics","netControl","_handlers","_msgid","_eventName2handler","_subeventName2msgid","_unsubeventName2msgid","_subscriptionid2eventName","_eventName2subscriptionid","connected","_msgId","_addHandler","msgid","fn","console","log","handler","data","removeAllMsg","Trace","_eventHandler","result","addEventListener","params","eventHandler","jsonrpc","method","id","JSON","stringify","sys","isNative","isMobile","os","OS_IOS","jsb","reflection","callStaticMethod","OS_ANDROID","OS_WINDOWS","OS_OSX","ret","GameSubscribe","Debug","onMessage","removeEventListener","GameCall","_isSubscriptionMsgid","eventName","_isUnsubscriptionMsgid","jsonstr","jsonRpc","parse","undefined","subeventName","unsubeventName","subscriptionid","subscription","init","gameCall","msgHandler","Warn","bind","AsyncGameCall"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Log = require(\"Log\")\n\nvar Global = cc.Class({\n    extends: cc.Component,\n    statics: {\n        netControl: null,\n        _handlers: null,\n        _msgid: null,\n        _eventName2handler: null,\n        _subeventName2msgid: null,\n        _unsubeventName2msgid: null,\n        _subscriptionid2eventName: null,\n        _eventName2subscriptionid: null,\n        connected: false,\n        _msgId:function() {\n            return this._msgid++;\n        },\n\n        _addHandler:function(msgid, fn) {\n            if(this._handlers[msgid]){\n                console.log(\"msgid:\" + msgid + \"' handler has been registered.\");\n                return;\n            }\n            var handler = function(data){\n                //console.log(event + \"(\" + typeof(data) + \"):\" + (data? data.toString():\"null\"));\n                //if(typeof(data) == \"string\"){\n                //    data = JSON.parse(data);\n                //}\n                fn(data);\n            };\n            \n            this._handlers[msgid] = handler; \n        },\n\n        /*\n        connect:function(fnConnect, fnError, addr) {\n            this._handlers = {};\n            this._msgid = 0;\n            this._eventName2handler = {};\n            this._eventName2msgid = {};\n            this._subscriptionid2eventName = {};\n            this._eventName2subscriptionid = {};\n            this.netControl = require('NetControl');\n            this.netControl.connect(addr);\n            this.messageFire = onfire.on(\"onopen\", fnConnect.bind(this));\n            this.messageFire = onfire.on(\"onclose\", fnError.bind(this));\n            this.messageFire = onfire.on(\"onmessage\", this._onMessage.bind(this));\n        },\n\n        sendMsg:function(params, msgHandler) {\n            var data = {\n                jsonrpc: \"2.0\",\n                method: \"dgame_call\",\n                params: params,\n                id: this._msgId(),\n            };\n            if (msgHandler != null && msgHandler != undefined) {\n                this._addHandler(data.id, msgHandler.bind(this));\n            }\n            this.netControl.send(JSON.stringify(data));\n        },\n        */\n        removeAllMsg:function() {\n            Log.Trace(\"removeAllMsg\");\n            this._handlers = {}\n        },\n\n        _eventHandler:function(result) {\n            this._subscriptionid2eventName\n        },\n\n        addEventListener:function(params, eventHandler) {\n            var data = {\n                jsonrpc: \"2.0\",\n                method: \"dgame_subscribe\",\n                params: params,\n                id: this._msgId(),\n            };\n            this._eventName2handler[params[0]] = eventHandler;\n            this._subeventName2msgid[params[0]] = data.id;\n            //this.netControl.send(JSON.stringify(data));\n            Log.Trace(\"addEventListener: \" + JSON.stringify(data));\n            if (cc.sys.isNative) {\n                if (cc.sys.isMobile) {\n                    if (cc.sys.os === cc.sys.OS_IOS) {\n                        jsb.reflection.callStaticMethod(\"NativeGengine\", \"GameSubscribe:andCallBack:\", JSON.stringify(data), \"cc.dgame.net.onMessage\");\n                    } else if (cc.sys.os === cc.sys.OS_ANDROID) {\n                        jsb.reflection.callStaticMethod(\"io/kaleidochain/NativeGengine\", \"GameSubscribeAndCallBack\", \"(Ljava/lang/String;Ljava/lang/String;)V\", JSON.stringify(data), \"cc.dgame.net.onMessage\");\n                    }    \n                } else {\n                    if (cc.sys.os === cc.sys.OS_WINDOWS||cc.sys.os === cc.sys.OS_OSX) {\n                        var ret = GameSubscribe(JSON.stringify(data));\n                        Log.Debug(\"GameSubscribe ret = \"+ret);\n                        this.onMessage(ret);\n                    }\n                }\n            }\n        },\n\n        removeEventListener:function(params) {\n            Log.Trace(\"removeEventListener: \" + params[0]);\n            var data = {\n                jsonrpc: \"2.0\",\n                method: \"dgame_unsubscribe\",\n                params: [this._eventName2subscriptionid[params[0]]],\n                id: this._msgId(),\n            };\n            if (this._eventName2subscriptionid[params[0]] != null) {\n                this._eventName2handler[params[0]] = null;\n                Log.Trace(\"Remove EventName: \" + params[0] + \", SubscriptionId: \" + this._eventName2subscriptionid[params[0]]);\n                this._unsubeventName2msgid[params[0]] = data.id;\n                //this.netControl.send(JSON.stringify(data));\n                if (cc.sys.isNative) {\n                    if (cc.sys.isMobile) {\n                        if (cc.sys.os === cc.sys.OS_IOS) {\n                            jsb.reflection.callStaticMethod(\"NativeGengine\", \"GameCall:andCallBack:\", JSON.stringify(data), \"cc.dgame.net.onMessage\");\n                        } else if (cc.sys.os === cc.sys.OS_ANDROID) {\n                            jsb.reflection.callStaticMethod(\"io/kaleidochain/NativeGengine\", \"GameCallAndCallBack\", \"(Ljava/lang/String;Ljava/lang/String;)V\", JSON.stringify(data), \"cc.dgame.net.onMessage\");\n                        }\n                    } else {\n                        if (cc.sys.os === cc.sys.OS_WINDOWS||cc.sys.os === cc.sys.OS_OSX) {\n                            var ret = GameCall(JSON.stringify(data));\n                            Log.Debug(\"removeEventListener GameCall ret = \" + ret);\n                            this.onMessage(ret);\n                        }\n                    }\n                }\n            }\n        },\n\n        _isSubscriptionMsgid:function(msgid) {\n            for (var eventName in this._subeventName2msgid) {\n                if (this._subeventName2msgid[eventName] == msgid)\n                    return eventName;\n            }\n            return null;\n        },\n\n        _isUnsubscriptionMsgid:function(msgid) {\n            for (var eventName in this._unsubeventName2msgid) {\n                if (this._unsubeventName2msgid[eventName] == msgid)\n                    return eventName;\n            }\n            return null;\n        },\n        /*\n        _onMessage:function(obj){\n            Log.Trace(\"_onMessage: \" + JSON.stringify(obj.data));\n            var jsonRpc = JSON.parse(obj.data);\n            if (jsonRpc.id != undefined) {\n                var eventName = this._isSubscriptionMsgid(jsonRpc.id);\n                if (eventName != null) {\n                    this._subscriptionid2eventName[jsonRpc.result] = eventName;\n                    this._eventName2subscriptionid[eventName] = jsonRpc.result;\n                    Log.Trace(\"Add EventName: \" + eventName + \", SubscriptionId: \" + jsonRpc.result);\n                    this._eventName2msgid[eventName] = null;\n                } else {\n                    if (this._handlers[jsonRpc.id]) {\n                        this._handlers[jsonRpc.id](jsonRpc.result);\n                    }\n                }\n                this._handlers[jsonRpc.id] = null;\n            } else {\n                var subscriptionid = jsonRpc.params.subscription;\n                if (this._eventName2handler[this._subscriptionid2eventName[subscriptionid]]) {\n                    Log.Trace(\"Invoke SubscriptionId: \" + subscriptionid + \", EventName: \" + this._subscriptionid2eventName[subscriptionid] + \", data: \" + obj.data);\n                    this._eventName2handler[this._subscriptionid2eventName[subscriptionid]](jsonRpc.params.result);\n                }\n            }\n        },\n        */\n\n        onMessage (jsonstr){\n            Log.Trace(\"onMessage: \" + jsonstr);\n            var jsonRpc = JSON.parse(jsonstr);\n            if (jsonRpc.id != undefined) {\n                //call返回：{\"jsonrpc\":\"2.0\",\"id\":9,\"result\":\"{\\\"SeatStatus\\\":3}\"}\n                var subeventName = this._isSubscriptionMsgid(jsonRpc.id);\n                var unsubeventName = this._isUnsubscriptionMsgid(jsonRpc.id);\n                if (subeventName != null || unsubeventName != null) {\n                    //subscribe返回：{\"jsonrpc\":\"2.0\",\"id\":11,\"result\":\"0x609c1054e40bab03aeed1a6c42a5b424\"}\n                    //unsubscribe返回：{\"jsonrpc\":\"2.0\",\"id\":58,\"result\":true}\n                    if (subeventName != null) {\n                        this._subscriptionid2eventName[jsonRpc.result] = subeventName;\n                        this._eventName2subscriptionid[subeventName] = jsonRpc.result;\n                        Log.Trace(\"Add EventName: \" + subeventName + \", SubscriptionId: \" + jsonRpc.result);\n                        this._subeventName2msgid[subeventName] = null;\n                    }\n                    if (unsubeventName != null) {\n                        var subscriptionid = this._eventName2subscriptionid[unsubeventName];\n                        Log.Trace(\"Remove EventName: \" + unsubeventName + \", SubscriptionId: \" + subscriptionid);\n                        this._eventName2subscriptionid[unsubeventName] = null;\n                        this._subscriptionid2eventName[subscriptionid] = null;\n                        this._unsubeventName2msgid[unsubeventName] = null;\n                    }\n                } else {\n                    if (this._handlers[jsonRpc.id]) {\n                        this._handlers[jsonRpc.id](jsonRpc.result);\n                    }\n                }\n                this._handlers[jsonRpc.id] = null;\n            } else {\n                //事件回调：{\"jsonrpc\":\"2.0\",\"method\":\"dgame_subscription\",\"params\":{\"subscription\":\"0x609c1054e40bab03aeed1a6c42a5b424\",\n                //\"result\":{\"Addr\":\"0x5806dc6556C3b2343ECC150A5eA8D3cB3ABA41F5\",\"Amount\":\"20000\",\"Errstr\":\n                //\"SitDown Result Msg timeout\",\"Pos\":2,\"Tableid\":4222124650659841}}}\n                var subscriptionid = jsonRpc.params.subscription;\n                if (this._eventName2handler[this._subscriptionid2eventName[subscriptionid]]) {\n                    Log.Trace(\"Invoke SubscriptionId: \" + subscriptionid + \", EventName: \" + this._subscriptionid2eventName[subscriptionid] + \", data: \" + jsonstr);\n                    this._eventName2handler[this._subscriptionid2eventName[subscriptionid]](jsonRpc.params.result);\n                }\n            }\n        },\n\n        init () {\n            this._handlers = {};\n            this._msgid = 0;\n            this._eventName2handler = {};   //事件名称到响应函数的映射关系\n            this._subeventName2msgid = {};     //订阅事件名称与订阅消息id映射关系\n            this._unsubeventName2msgid = {};     //取消订阅事件名称与订阅消息id映射关系\n            this._subscriptionid2eventName = {};    //订阅id与事件名称的映射关系\n            this._eventName2subscriptionid = {};    //事件名称与订阅id的映射关系\n        },\n\n        gameCall (params, msgHandler) {\n            var data = {\n                jsonrpc: \"2.0\",\n                method: \"dgame_call\",\n                params: params,\n                id: this._msgId(),\n            };\n            if (!this.connected && params[0] != \"rungame\" && params[0] != \"selfaddress\") {\n                Log.Warn(\"gameCall: \" + JSON.stringify(data) + \" failed.\");\n                return;\n            }\n            if (msgHandler != null && msgHandler != undefined) {\n                this._addHandler(data.id, msgHandler.bind(this));\n            }\n            Log.Trace(\"gameCall: \" + JSON.stringify(data));\n            if (cc.sys.isNative) {\n                if (cc.sys.isMobile) {\n                    if (cc.sys.os === cc.sys.OS_IOS) {\n                        jsb.reflection.callStaticMethod(\"NativeGengine\", \"AsyncGameCall:andCallBack:\", JSON.stringify(data), \"cc.dgame.net.onMessage\");\n                    } else if (cc.sys.os === cc.sys.OS_ANDROID) {\n                        jsb.reflection.callStaticMethod(\"io/kaleidochain/NativeGengine\", \"AsyncGameCallAndCallBack\", \"(Ljava/lang/String;Ljava/lang/String;)V\", JSON.stringify(data), \"cc.dgame.net.onMessage\");\n                    }\n                } else {\n                    if (cc.sys.os === cc.sys.OS_WINDOWS||cc.sys.os === cc.sys.OS_OSX) {\n                        AsyncGameCall(JSON.stringify(data), \"cc.dgame.net.onMessage\");\n                    }\n                }\n            }\n        },\n    },\n});"]}