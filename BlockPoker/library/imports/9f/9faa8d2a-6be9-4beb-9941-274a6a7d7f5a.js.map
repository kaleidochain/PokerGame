{"version":3,"sources":["assets/scripts/Wallet/LoginMnemonic.js"],"names":["Log","require","cc","Class","Component","properties","loginMnemonic","Node","createPassoword","createNickname","editPassword","EditBox","editNickname","nicknameErrorTips","Label","passwordErrorTips","loginMnemonicErrorTips","editMnemonics","type","onBtnBackClicked","console","log","dgame","sceneList","active","director","loadScene","pop","onLoad","onBtnLoginMnemonicClicked","mnemonic","hasError","i","length","string","scheduleOnce","Debug","onBtnCreatePasswordClicked","pubkey","sys","os","OS_IOS","jsb","reflection","callStaticMethod","localStorage","getItem","OS_ANDROID","OS_WINDOWS","OS_OSX","ImportAccountWithPasswordAndLanguage","undefined","accountAddr","onBtnCreateNicknameClicked","_isNicknameExist","accountInfo","Nickname","Addr","LoginCount","settings","account","JSON","stringify","_updateAccountsInfo","setItem","Password","tutorial","parse","TexasHoldem","nickname","accountsInfo","Array","accountsMap","addr","push","Trace"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Log = require(\"Log\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        loginMnemonic: cc.Node,\n        createPassoword: cc.Node,\n        createNickname: cc.Node,\n        editPassword: cc.EditBox,\n        editNickname: cc.EditBox,\n        nicknameErrorTips: cc.Label,\n        passwordErrorTips: cc.Label,\n        loginMnemonicErrorTips: cc.Label,\n        editMnemonics: {\n            default: [],\n            type: cc.EditBox,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n    onBtnBackClicked () {\n        console.log(\"sceneList: \" + cc.dgame.sceneList);\n        if (this.loginMnemonic.active) {\n            cc.director.loadScene(cc.dgame.sceneList.pop());\n        } else if (this.createPassoword.active) {\n            this.loginMnemonic.active = true;\n            this.createPassoword.active = false;\n            this.createNickname.active = false;    \n        } else if (this.createNickname.active) {\n            this.loginMnemonic.active = false;\n            this.createPassoword.active = true;\n            this.createNickname.active = false;    \n        }\n    },\n\n    onLoad () {\n        this.loginMnemonic.active = true;\n        this.createPassoword.active = false;\n        this.createNickname.active = false;\n    },\n\n    // update (dt) {},\n\n    onBtnLoginMnemonicClicked () {\n        this.mnemonic = \"\";\n        let hasError = false;\n        for (var i = 0; i < this.editMnemonics.length; i++) {\n            if (this.editMnemonics[i].string == \"\") {\n                hasError = true;\n                break;\n            }\n            if (i != this.editMnemonics.length - 1) {\n                this.mnemonic = this.mnemonic + this.editMnemonics[i].string + \" \";\n            } else {\n                this.mnemonic = this.mnemonic + this.editMnemonics[i].string;\n            }\n        }\n        if (hasError) {\n            this.loginMnemonicErrorTips.string = \"The mnemonic is empty, please re-enter\";\n            this.scheduleOnce(function() {\n                this.loginMnemonicErrorTips.string = \"\";\n            }, 3)\n        } else {\n            Log.Debug(\"mnemonic: \" + this.mnemonic);\n            this.loginMnemonic.active = false;\n            this.createPassoword.active = true;\n            this.createNickname.active = false;\n        }\n    },\n\n    onBtnCreatePasswordClicked () {\n        if (!(this.editPassword.string.length >= 6 && this.editPassword.string.length <= 12)) {\n            this.passwordErrorTips.string = \"Invalid password length\";\n            this.scheduleOnce(function() {\n                this.passwordErrorTips.string = \"\";\n            }, 3);\n            return;\n        }\n        var pubkey = \"\";\n        if (cc.sys.os === cc.sys.OS_IOS) {\n            pubkey = jsb.reflection.callStaticMethod(\"NativeGengine\", \"importAccount:withPassword:AndLanguage:\", this.mnemonic, this.editPassword.string, cc.sys.localStorage.getItem(\"mnemonicLanguage\"));\n        } else if (cc.sys.os === cc.sys.OS_ANDROID) {\n            pubkey = jsb.reflection.callStaticMethod(\"io/kaleidochain/NativeGengine\", \"importAccountWithPasswordAndLanguage\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\", this.mnemonic, this.editPassword.string, cc.sys.localStorage.getItem(\"mnemonicLanguage\"));\n        }   else if (cc.sys.os === cc.sys.OS_WINDOWS||cc.sys.os === cc.sys.OS_OSX) {\n            pubkey = ImportAccountWithPasswordAndLanguage(this.mnemonic, this.editPassword.string, cc.sys.localStorage.getItem(\"mnemonicLanguage\"));\n        }\n        Log.Debug(\"pubkey: \" + pubkey);\n        if (pubkey !== null && pubkey !== undefined && pubkey.length > 0) {\n            this.loginMnemonic.active = false;\n            this.createPassoword.active = false;\n            this.createNickname.active = true;\n            this.accountAddr = pubkey;\n        } else {\n            this.loginMnemonic.active = true;\n            this.createPassoword.active = false;\n            this.createNickname.active = false;\n            this.loginMnemonicErrorTips.string = \"The mnemonic is incorrect, please re-enter\";\n            this.scheduleOnce(function() {\n                this.loginMnemonicErrorTips.string = \"\";\n            }, 3)\n        }\n    },\n\n    onBtnCreateNicknameClicked () {\n        if (this.editNickname.string == \"\") {\n            this.nicknameErrorTips.string = \"Empty nickname\";\n            this.scheduleOnce(function() {\n                this.nicknameErrorTips.string = \"\";\n            }, 3);\n            return;\n        }\n        if (this._isNicknameExist(this.editNickname.string)) {\n            this.nicknameErrorTips.string = \"The nickname already exists on this device\";\n            this.scheduleOnce(function() {\n                this.nicknameErrorTips.string = \"\";\n            }, 3);\n            return;\n        }\n        var accountInfo = {};\n        accountInfo.Nickname = this.editNickname.string;\n        accountInfo.Addr = this.accountAddr;\n        accountInfo.LoginCount = 0;\n        cc.dgame.settings.account = accountInfo;\n        Log.Debug(\"cc.dgame.settings.account = \" + JSON.stringify(cc.dgame.settings.account))\n        this._updateAccountsInfo(accountInfo);\n        cc.sys.localStorage.setItem(\"currentAccount\", JSON.stringify(accountInfo));\n        cc.dgame.settings.account.Password = this.editPassword.string;\n        let tutorial = JSON.parse(cc.sys.localStorage.getItem(\"tutorial\"));\n        if (!tutorial.TexasHoldem) {\n            cc.director.loadScene(\"TexasHoldemTutorial\");\n        } else {\n            cc.director.loadScene(\"GameHall\");\n        }\n    },\n\n    _isNicknameExist (nickname) {\n        for (let i = 0; i < cc.dgame.settings.accountsInfo.length; i++) {\n            if (cc.dgame.settings.accountsInfo[i].Nickname == nickname) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    _updateAccountsInfo (accountInfo) {\n        //同步accountsInfo的昵称\n        var accountsInfo = new Array();\n        //先地址去重\n        var accountsMap = {};\n        for (var i = 0; i < cc.dgame.settings.accountsInfo.length; i++) {\n            accountsMap[cc.dgame.settings.accountsInfo[i].Addr] = cc.dgame.settings.accountsInfo[i].Nickname;\n        }\n        accountsMap[accountInfo.Addr] = accountInfo.Nickname;\n\n        for (var addr in accountsMap) {\n            accountsInfo.push({\"Nickname\": accountsMap[addr], \"Addr\": addr});\n        }\n        cc.sys.localStorage.setItem(\"accountsInfo\", JSON.stringify(accountsInfo));\n        Log.Trace(\"accountsInfo: \" + JSON.stringify(accountsInfo));\n    },\n});\n"]}