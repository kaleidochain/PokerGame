{"version":3,"sources":["assets/scripts/components/ClubResultsPopup.js"],"names":["Log","require","cc","Class","Component","properties","_clubResultsPopup","Node","onLoad","dgame","Trace","tableInfo","TableProps","parseInt","TableId","find","active","utils","addClickEvent","node","start","onBtnCloseClubResultsClicked","onBtnClubResultsClicked","popup","dstv2","getPosition","setPosition","winSize","width","runAction","moveTo","normalLoading","startInvokeWaiting","scheduleOnce","tableDetail_cmd","net","gameCall","JSON","stringify","_onTableDetail","bind","showLoadTimeout","stopInvokeWaiting","tableIdLabel","getComponent","Label","string","clubid","Math","floor","displayTableId","InsuranceWin","winLabel","leftTimeLabel","LeftTime","timeToHMS","populateList","Result","onDestroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Log = require('Log');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _clubResultsPopup: cc.Node,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        if (!cc.dgame) {\r\n            return;\r\n        }\r\n        Log.Trace(\"ClubResultsPopup onLoad (cc.dgame.tableInfo.TableProps & 0x1):\" + ((cc.dgame.tableInfo.TableProps & 0x1)));\r\n        if ( parseInt(cc.dgame.tableInfo.TableId) < 0xE000000000000 && ((cc.dgame.tableInfo.TableProps & 0x1) == 0) ){\r\n            cc.find(\"Canvas/MenuLayer/LeftTopMemuLayer/BtnClubResults\").active = true;\r\n        }\r\n        if (!!cc.find(\"Canvas/MenuLayer/LeftTopMemuLayer/BtnClubResults\")) {\r\n            this._clubResultsPopup = cc.find(\"Canvas/MenuLayer/ClubResultsPopup\");\r\n            cc.dgame.utils.addClickEvent(cc.find(\"returnBackground\", this._clubResultsPopup), this.node, \"ClubResultsPopup\", \"onBtnCloseClubResultsClicked\");\r\n            cc.dgame.utils.addClickEvent(cc.find(\"Canvas/MenuLayer/LeftTopMemuLayer/BtnClubResults\"), this.node, \"ClubResultsPopup\", \"onBtnClubResultsClicked\");\r\n        }\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    onBtnCloseClubResultsClicked () {\r\n        this._clubResultsPopup.active = false;\r\n    },\r\n    \r\n    onBtnClubResultsClicked () {\r\n        let popup = cc.find('sprite_splash', this._clubResultsPopup);\r\n        let dstv2 = popup.getPosition();\r\n        popup.setPosition(- cc.winSize.width / 2, 0);\r\n        popup.runAction(\r\n            cc.moveTo(0.2, dstv2),\r\n        );\r\n        this._clubResultsPopup.active = true;\r\n        cc.dgame.normalLoading.startInvokeWaiting();\r\n        this.scheduleOnce(function () {\r\n            var tableDetail_cmd = {\r\n                TableId: cc.dgame.tableInfo.TableId,\r\n            };\r\n            cc.dgame.net.gameCall(['tableDetail', JSON.stringify(tableDetail_cmd)], this._onTableDetail.bind(this));\r\n        }, 0.05);\r\n    },\r\n\r\n    _onTableDetail (tableInfo) {\r\n        Log.Trace(\"ClubResultsPopup _onTableDetail tableInfo:\" + JSON.stringify(tableInfo));\r\n        if (tableInfo == \"Network disconnected\") {\r\n            cc.dgame.normalLoading.showLoadTimeout();\r\n            return;\r\n        }\r\n        cc.dgame.normalLoading.stopInvokeWaiting();\r\n        let tableIdLabel = cc.find(\"sprite_splash/HeaderLayer/roomId\", this._clubResultsPopup).getComponent(cc.Label);\r\n        tableIdLabel.string = \"Room:\";\r\n        let clubid = Math.floor(tableInfo.TableId / 0x10000000);\r\n        let displayTableId = tableInfo.TableId - clubid * 0x10000000;\r\n        if (displayTableId < 10) {\r\n            tableIdLabel.string += '00' + displayTableId;\r\n        } else if (displayTableId < 100) {\r\n            tableIdLabel.string += '0' + displayTableId;\r\n        } else {\r\n            tableIdLabel.string += displayTableId;\r\n        }\r\n        if ( tableInfo.InsuranceWin != null ) {\r\n            cc.find(\"sprite_splash/scrollview/view/content/ins_layer\", this._clubResultsPopup).active = true;\r\n            let winLabel = cc.find(\"sprite_splash/scrollview/view/content/ins_layer/label\", this._clubResultsPopup).getComponent(cc.Label);\r\n            winLabel.string = tableInfo.InsuranceWin;\r\n        }\r\n        let leftTimeLabel = cc.find(\"sprite_splash/HeaderLayer/time\", this._clubResultsPopup).getComponent(cc.Label);\r\n        Log.Trace(\"tableInfo.LeftTime:\" + tableInfo.LeftTime);\r\n        leftTimeLabel.string = cc.dgame.utils.timeToHMS(tableInfo.LeftTime);\r\n\r\n        cc.find(\"sprite_splash/scrollview\",this._clubResultsPopup).getComponent(\"TableResultPlayersList\").populateList(tableInfo.Result);\r\n    },\r\n\r\n    onDestroy () {\r\n    }\r\n    // update (dt) {},\r\n});\r\n"]}